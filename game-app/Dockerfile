# syntax=docker/dockerfile:1
FROM node:latest
ENV NODE_ENV=production
# SET ENV TO PRODUCTION WHEN DONE
WORKDIR /usr/src/app

# Metadata for npm
#package.json is a versoning file used to install multiple packages in your project.
# package.json.lock is generated by npm init, fro mthe package .json
# Link : https://www.geeksforgeeks.org/difference-between-package-json-and-package-lock-json-files/

COPY ["./package.json", "./package-lock.json*", "./"]

# # npm install will download all dependencies defined in package.json
# # into node_modules
RUN npm install -g @nestjs/cli
RUN npm install 

# # Installed all dependencies, now we copy over the sourcecode
COPY . .
RUN npm run build
EXPOSE 8080 9000 3001
#wait-for-it.sh ${POSTGRES_HOST}:5432 -s -t 0 -- npm run start:prod
CMD ["./wait-for-it.sh", "chat-app:8080", "--", "npm", "run", "start:prod"]
#command: ["./wait-for-it.sh", "db:5432", "--", "python", "app.py"]
#CMD ["npm", "run", "start:prod"]